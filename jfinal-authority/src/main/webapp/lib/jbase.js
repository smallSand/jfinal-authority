var jbaseModule=angular.module("jbaseModule",["ui.router","ui.utils","pascalprecht.translate","ngCookies","ui.uploader"],["$httpProvider",function(e){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var t=function(e){var n,o,a,i,r,c,l,s="";for(n in e)if(o=e[n],o instanceof Array)for(l=0;l<o.length;++l)r=o[l],a=n+"["+l+"]",c={},c[a]=r,s+=t(c)+"&";else if(o instanceof Object)for(i in o)r=o[i],a=n+"["+i+"]",c={},c[a]=r,s+=t(c)+"&";else void 0!==o&&null!==o&&(s+=encodeURIComponent(n)+"="+encodeURIComponent(o)+"&");return s.length?s.substr(0,s.length-1):s};e.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?t(e):e}]}]);jbaseModule.factory("jbase",["$http","$rootScope","$timeout","uiUploader",function($http,$rootScope,$timeout,uiUploader){var jbase={AJAX_FAIL_CALLBACK:null,post:function(e,t,n){$.AMUI.progress.start(),$http.post(e,t).success(function(e){$.AMUI.progress.done(),n&&n(e)}).error(function(e,t){$.AMUI.progress.done(),jbase.AJAX_FAIL_CALLBACK&&jbase.AJAX_FAIL_CALLBACK(e,t)})},upload:function(e,$scope,url,func){uiUploader.addFiles(e.target.files),uiUploader.startUpload({url:url,onProgress:function(){},onCompleted:function(file,d){d=eval("("+d+")"),func&&$scope.$apply(function(){func(d)})}})},rsa:function(e,t,n){var o=RSAUtils.getKeyPair(e,"",t);return RSAUtils.encryptedString(o,n)},find:function(e,t,n){var o;return angular.forEach(n,function(n){return n[e]==t?(o=jbase.clone(n),void delete o.$$hashKey):void 0}),o},toArray:function(e,t){var n=[];return angular.forEach(t,function(t){t[e]&&n.push(t[e])}),n},clone:function(e){if("object"!=typeof e)return e;if(null==e)return e;var t=new Object;for(var n in e)t[n]=jbase.clone(e[n]);return delete t.$$hashKey,t},toParam:function(e,t,n){var o=jbase.clone(t);for(var a in o)n&&-1!=n.indexOf(a)||(o[e+"."+a]=o[a],delete o[a]);return o},delay:function(e,t,n){$timeout(function(){e&&e(),$timeout(function(){t&&t()},n)},n)}};return jbase}]),jbaseModule.directive("amValidator",["$parse",function(){return{restrict:"A",scope:{validate:"&"},link:function(e,t){t.validator({validate:function(t){return e.validate?e.validate({v:t}):void 0}})}}}]),jbaseModule.directive("fileread",[function(){return{scope:{fileread:"="},link:function(e,t){t.bind("change",function(t){return _.map(t.target.files,function(t){e.fileread=[];var n=new FileReader;n.onload=function(t){e.$apply(function(){e.fileread.push(t.target.result)})},n.readAsDataURL(t)})})}}}]),jbaseModule.directive("amValidatorTooltip",["$parse",function(){return{restrict:"A",scope:{validate:"&"},link:function(e,t){var n=$('<div id="vld-tooltip"></div>');n.appendTo(document.body),t.validator({validate:function(t){return e.validate?(n.hide(),e.validate({v:t})):void 0}});var o=t.data("amui.validator");t.on("focusin focusout",".am-form-error input",function(e){if("focusin"===e.type){var t=$(this),a=t.offset(),i=t.data("foolishMsg")||o.getValidationMessage(t.data("validity"));n.text(i).show().css({left:a.left+10,top:a.top+$(this).outerHeight()+10})}else n.hide()})}}}]),jbaseModule.directive("amDropdown",function(){return{restrict:"A",link:function(e,t){var n=t.parent();t.dropdown({justify:n})}}}),jbaseModule.directive("amFullscreen",["$document",function(e){return{restrict:"A",link:function(t,n){n.on("click",function(){$.AMUI.fullscreen.toggle()});var o=n.children("[am-fullscreen-text]");e.on($.AMUI.fullscreen.raw.fullscreenchange,function(){o.text($.AMUI.fullscreen.isFullscreen?"关闭全屏":"开启全屏")})}}}]),jbaseModule.directive("amLoading",function(){return{restrict:"AE",scope:{title:"=",show:"=",closed:"&"},link:function(e,t){t.on("closed.modal.amui",function(){e.$apply(function(){e.closed&&e.closed()})}),e.$watch("show",function(){1==e.show?t.modal({closeViaDimmer:0}):0==e.show&&t.modal("close")})},template:'<div class="am-modal am-modal-loading am-modal-no-btn" tabindex="-1"  >\n    	<div class="am-modal-dialog"> <div class="am-modal-hd">{{title}}</div> <div class="am-modal-bd">\n    	 <span class="am-icon-spinner am-icon-spin"></span></div></div></div>',replace:!0}}),jbaseModule.directive("amAlert",function(){return{restrict:"AE",scope:{title:"@",content:"@",show:"="},replace:!0,transclude:!0,link:function(e,t){t.on("close.modal.amui",function(){e.$apply(function(){e.show=!1})}),e.$watch("show",function(){1==e.show&&t.modal("open")})},template:'<div class="am-modal am-modal-alert" tabindex="-1" >\n      <div class="am-modal-dialog">\n        <div class="am-modal-hd">{{title}}</div>\n        <div class="am-modal-bd">{{content}} </div>\n        <div class="am-modal-footer">\n          <span class="am-modal-btn">确定</span>\n        </div>\n      </div>\n    </div>'}}),jbaseModule.directive("amModal",function(){return{restrict:"A",scope:{show:"="},link:function(e,t){t.on("closed.modal.amui",function(){e.$apply(function(){e.show&&(e.show=!1)})}),e.$watch("show",function(){1==e.show?t.modal({closeViaDimmer:0}):0==e.show&&t.modal("close")})}}}),jbaseModule.directive("amPopover",function(){return{restrict:"A",scope:{show:"=",content:"@",trigger:"@"},link:function(e,t){e.$watch("show",function(){1==e.show?t.popover({content:e.content,trigger:e.trigger}):0==e.show&&t.eq(0).removeData("amui.popover")})}}}),jbaseModule.directive("amConfirm",function(){return{restrict:"AE",scope:{title:"@",content:"@",show:"=",ok:"="},replace:!0,transclude:!0,link:function(e,t){t.on("closed.modal.amui",function(){e.$apply(function(){e.show=!1})}),e.$watch("show",function(){1==e.show&&t.modal({relatedTarget:this,onConfirm:function(){"undefined"!=typeof e.ok&&(e.ok=!0)}})})},template:'<div class="am-modal am-modal-confirm" tabindex="-1"  >\n       <div class="am-modal-dialog">\n        <div class="am-modal-hd">{{title}}</div>\n        <div class="am-modal-bd"> {{content}} </div>\n        <div class="am-modal-footer">\n        <span class="am-modal-btn" data-am-modal-cancel>取消</span>\n        <span class="am-modal-btn" data-am-modal-confirm>确定</span>\n       </div>\n      </div>\n    </div>'}}),jbaseModule.directive("formFile",function(){return{restrict:"A",link:function(e,t){t.on("change",function(){var e="";$.each(this.files,function(){e+=' <span class="am-badge">'+this.name+"</span>  "}),t.next().html(e)})}}}),jbaseModule.directive("fancybox",function(){return{restrict:"A",link:function(e,t){t.fancybox()}}}),jbaseModule.directive("simditor",function(){return{restrict:"A",scope:{editor:"="},link:function(e,t){e.editor=new Simditor({textarea:t})}}}),jbaseModule.directive("duoshuo",function(){return{restrict:"A",link:function(e,t){var n=document.createElement("div");n.setAttribute("data-thread-key","jbase"),n.setAttribute("data-url","http://127.0.0.1/"),DUOSHUO.EmbedThread(n),t.append(n)}}}),jbaseModule.directive("ztree",function(){return{restrict:"A",scope:{setting:"=",znodes:"=",obj:"="},link:function(e,t){e.$watch("znodes",function(){console.log("init ztree"),e.setting&&e.znodes&&(e.obj=$.fn.zTree.init(t,e.setting,e.znodes))})}}}),jbaseModule.directive("amDatepicker",function(){return{restrict:"A",scope:{data:"="},link:function(e,t){t.datepicker().on("changeDate.datepicker.amui",function(){$(this).datepicker("close"),e.$apply(function(){e.data=t.data("date")})})}}});