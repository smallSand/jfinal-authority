!function(t){function e(t,e){this.$element=t,this.$weatherArea=null,this.$weather=null,this.opts=e,this.sky=e.sky,this.skyState=e.weatherStates[e.sky]}function a(t,e){var a=e-t,n=t+Math.round(Math.random()*a);return parseInt(n)}function n(t,e){for(var a in e)t=t.split(a).join(e[a]);return t}function i(e){function a(t){if(n){var a=t.pageX-i,r=t.pageY-s;e.css({left:a,top:r})}}var n=!1,i=0,s=0;return e.mousedown(function(r){n=!0,i=r.pageX||0,s=r.pageY||0,i-=parseInt(e.css("left")),s-=parseInt(e.css("top")),e.addClass("weather-is-move"),t(document).bind("mousemove.weather",function(t){a(t)})}).mouseup(function(){n=!1,t(document).unbind("mousemove.weather",a()),e.removeClass("weather-is-move")}),e}var s={fps:40,duration:5e3,creatDropTime:400,sky:"sunshine",weatherData:{},move:!0,drag:!0,autoDrop:!1,weatherStates:{sunshine:{length:1},cloudy:{length:1},overcast:{length:2},rainy:{length:2,drop:[{time:300},{time:300}]},sleet:{length:2,drop:[{time:300},{time:800}]},snow:{length:2,drop:[{time:800},{time:800}]}}};t.fn.weather=function(a){a=t.extend({},s,a),a.sky=a.sky||s.sky,a.drag=!!a.drag,a.move=!!a.move,a.autoDrop=!!a.autoDrop;var n;return this.each(function(){n=new e(t(this),a),n.init(a.config)}),n.$weatherArea},e.prototype={constructor:e,version:"3.0",init:function(t){for(var e=this.opts.weatherData||{},a=[],i=(this.skyState||"").length,s='<div class="weather-info"><h2>{#city#}<span>{#date#}</span></h2><div class="weather-show"><div class="day_weather"><span class="weather">{#day#} : {#day_weather#}</span>/<span class="temp">{#day_temp#}{#temp#}</span></div><div class="night_weather"><span class="weather">{#night#} : {#night_weather#}</span>/<span class="temp">{#night_temp#}{#temp#}</span></div></div><div class="julying-weather-copy"><a href="http://julying.com/lab/weather/" target="_blank" title="&copy;{#wangzimo#}">julying</a></div></div>',r=0;i>r;r++)a.push('<div class="julying-weather"><div class="'+this.opts.sky+" sky sky-"+r+'"><div class="child-'+r+' child">'),e.city&&a.push(n(s,{"{#city#}":e.city,"{#date#}":e.date,"{#day#}":t.lang.day,"{#day_weather#}":e.day_weather,"{#day_temp#}":e.day_temp,"{#temp#}":t.lang.temp,"{#day_wind#}":e.day_wind,"{#night_weather#}":e.night_weather,"{#night#}":t.lang.night,"{#night_temp#}":e.night_temp,"{#wangzimo#}":t.lang.wangzimo})),a.push("</div></div></div>");return this.$element.append(a.join("")),a=null,this.$weatherArea=this.$element.find("div.julying-weather"),this.$weather=this.$element.find(".sky"),this.moveIcon(),this.creatDrop(),this.opts.drag&&this.dragWeather(),this},moveIcon:function(){function e(t,e){{var i=arguments.callee,s=t.parent().width(),r=t.width()||160,o=s-r,h=_self.opts.duration,c=a(0,o),p=_self.opts.fps,d=Math.abs(parseInt(t.css("left"))-c)*a(.8*p,1.2*p)||5e3;a(h-.5*h,h+.5*h)}t.animate({left:c},d,"linear",function(){n[e]=setTimeout(function(){i(t,e)},a(50,1e3))})}var n=[];_self=this,this.$weather.each(function(i){var s=t(this),r=s.find(".weather-info");return s.click(function(){return s.hasClass("weather-is-move")||r.show(300),!1}).show(),t(document).click(function(){r.hide(300)}),_self.opts.move?(s.css({left:a(0,.8*s.parent().width())}).show(),s.hover(function(){s.stop(),n[i]&&clearTimeout(n[i])},function(){n[i]&&clearTimeout(n[i]),n[i]=setTimeout(function(){e(s,i)},a(200,1e3)),r.hide(300)}),e(s,i),t(window).resize(function(){clearTimeout(n[i]||{}),s.stop().animate({left:a(0,.5*s.parent().width())},300,function(){e(s,i)})}),_self):_self})},creatDrop:function(){var e=this;this.$weather.each(function(){if(!e.skyState.drop||!e.skyState.drop.length)return!1;var a=t(this),n=a.find(".child"),i=null;e.opts.autoDrop?setInterval(function(){e.drop(n)},e.opts.creatDropTime):a.hover(function(){clearInterval(i||{}),i=setInterval(function(){e.drop(n)},e.opts.creatDropTime)},function(){clearInterval(i||{})})})},drop:function(e){this.makeDrop(e),e.find("div[name=init]").each(function(){var n=t(this),i=parseInt(n.css("top"))||0,s=parseInt(n.attr("data-fly-time"))||200;n.attr({name:"run"}),setTimeout(function(){n.css({display:"block",top:a(i-10,i+10)}).animate({top:e.height()+parseInt(n.attr("data-end")),opacity:0},s,function(){n.remove()})},a(0,1e3))})},makeDrop:function(t){var e=t.width(),n=t.height(),i=0,s=0,r=a(0,(this.skyState.drop.length||1)-1),o=this.skyState.drop[r].time||300,h="",c=0,p=a(2,6);for(o=a(.5*o,2*o);p>=c;c++)i=a(0,.9*e),s=a(.5*n,2*n),h=h+'<div name="init" data-end="'+s+'" class="drop drop-'+r+'" data-fly-time="'+o+'" style="left:'+i+'px;"><i></i></div>';t.append(h)},dragWeather:function(){this.$weather.each(function(e){i(t(this),e)})}}}(jQuery);